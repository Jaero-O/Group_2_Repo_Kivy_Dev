#:kivy 2.0.0

<ResultScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 12
        spacing: 12

        BoxLayout:
            size_hint_y: None
            height: 48
            spacing: 8
            Button:
                text: 'Back'
                size_hint_x: None
                width: 80
                on_release: root.go_back()
            Label:
                text: 'Result'
                font_size: 28
                bold: True
                halign: 'left'
                valign: 'middle'
                text_size: self.size
            Widget:
                size_hint_x: 1

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 200
            spacing: 12
            Image:
                id: preview_image
                source: '' if (__import__('os').environ.get('HEADLESS_TEST') == '1') else root.image_path
                fit_mode: "contain"
            BoxLayout:
                orientation: 'vertical'
                spacing: 4
                Label:
                    text: 'Disease: ' + (root.disease_name if root.disease_name else 'â€”')
                    font_size: 16
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                Label:
                    text: 'Severity: ' + (str(int(root.severity_percentage)) + '%' if root.severity_percentage else '0%')
                    font_size: 16
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                Label:
                    text: 'Stage: ' + (root.severity_name if root.severity_name else 'Healthy')
                    font_size: 16
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                BoxLayout:
                    id: confidence_layout
                    size_hint_y: None
                    height: 24
                    Label:
                        text: 'Confidence: ' + (str(int(root.confidence*100)) + '%' if root.confidence else '0%')
                        font_size: 14
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size

        Label:
            id: dynamic_description
            text: root.disease_description if root.disease_description else 'No description available.'
            font_size: 14
            halign: 'left'
            valign: 'top'
            text_size: self.width, None
            size_hint_y: None
            height: self.texture_size[1] + 8

        BoxLayout:
            id: severity_legend
            size_hint_y: None
            height: 26
            spacing: 10
            Label:
                text: 'Healthy'
                font_size: 12
            Label:
                text: 'Mild'
                font_size: 12
            Label:
                text: 'Moderate'
                font_size: 12
            Label:
                text: 'Severe'
                font_size: 12

        BoxLayout:
            size_hint_y: None
            height: 48
            Widget:
                size_hint_x: 1
            Button:
                id: save_button
                text: 'Save'
                size_hint: None, None
                size: 120, 40
                disabled: not root.is_scan_result
                opacity: 1 if root.is_scan_result else 0
                on_release: root.open_save_screen()
            Widget:
                size_hint_x: 1
