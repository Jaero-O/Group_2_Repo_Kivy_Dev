#:kivy 2.0.0

<GuideScreen>:
    # Background layers
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            source: "app/assets/placeholder_bg1.png"
            pos: self.pos
            size: self.size
        Rectangle:
            source: "app/assets/bg_blur.png"
            pos: self.pos
            size: self.size

        # Rounded inner panel
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            id: inner_panel
            pos: self.x + 24, self.center_y - (self.height * 0.68 / 2)
            size: self.width - 48, self.height * 0.68
            radius: [40, 40, 40, 40]

        # Border for inner panel
        Color:
            rgba: 0, 0, 0, 0.05
        Line:
            rounded_rectangle: (self.x + 24, self.center_y - (self.height * 0.68 / 2), self.width - 48, self.height * 0.68, 40)
            width: 1.3

    # Header icon
    BoxLayout:
        orientation: "horizontal"
        size_hint: None, None
        size: 480, 60
        pos_hint: {"x": 0.18, "top": 0.80}
        spacing: 6

        Image:
            source: "app/assets/guide.png"
            size_hint: None, None
            size: 48, 48
            allow_stretch: True
            keep_ratio: True
            mipmap: True

    # Header label
    BoxLayout:
        orientation: "horizontal"
        size_hint: None, None
        size: 480, 60
        pos_hint: {"x": 0.30, "top": 0.795}
        spacing: 5

        Label:
            text: "Guide"
            color: 3/255, 30/255, 0/255, 1
            font_size: 34
            bold: True
            valign: "middle"
            halign: "left"
            text_size: self.size

    # Divider line below header
    FloatLayout:
        size_hint: 1, 1
        canvas:
            Color:
                rgba: 0, 0, 0, 0.15
            Rectangle:
                size: self.width * 0.7, 1.5
                pos: self.width * 0.15, self.height * 0.68

    # Instruction text
    Label:
        text: 
            "Before scanning, make sure the entire mango leaf is fully visible within the camera or scanner frame. Ensure no part of the leaf is cut off or out of view for accurate scanning results."
        color: 65/255, 65/255, 65/255, 1  
        font_size: 29
        halign: 'left'
        valign: 'top'
        pos_hint: {'center_x': 0.5, 'top': 0.64}
        text_size: self.width - 70, None
        size_hint: 0.85, None
        height: self.texture_size[1]

    # Back button to return to ScanScreen
    RoundedButton:
        id: back_button
        size_hint: None, None
        size: 96, 42
        pos_hint: {"center_x": 0.25, "y": 0.05}
        on_release: app.root.current = 'scan'

        # Button shadow, blur base, and surface
        canvas.before:
            Color:
                rgba: 0, 0, 0, 0.2
            RoundedRectangle:
                pos: self.x + 1, self.y - 2
                size: self.size
                radius: [14, 14, 14, 14]
            Color:
                rgba: 0.9, 0.9, 0.9, 0.4
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [14, 14, 14, 14]
            Color:
                rgba: 1, 1, 1, 0.7
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [14, 14, 14, 14]
        
        # Button shadow, base color, and touch feedback
        canvas.before:
            Color:
                rgba: self.shadow_color
            RoundedRectangle:
                pos: self.x + self.shadow_offset_x, self.y - self.shadow_offset_y
                size: self.size
                radius: [18, 18, 18, 18]
            Color:
                rgba: 1, 1, 1, 1
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [18, 18, 18, 18]
            Color:
                rgba: 0.5, 0.5, 0.5, 0.3 if self.state == 'down' else 0  # Touch feedback overlay
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [18, 18, 18, 18]

        # Layout containing icon and label
        BoxLayout:
            orientation: "horizontal"
            size: back_button.size
            pos: back_button.pos
            spacing: 4

            Widget:
                size_hint_x: 1

            Image:
                source: "app/assets/back.png"
                allow_stretch: True
                keep_ratio: True
                size_hint: None, None
                size: 17, 17
                pos_hint: {"center_y": 0.5}
                mipmap: True

            Label:
                text: "Back"
                color: 3/255, 30/255, 0/255, 1
                font_size: 15
                bold: True
                size_hint_x: None
                width: self.texture_size[0]
                halign: "left"
                valign: "middle"
                pos_hint: {"center_y": 0.5}
            
            Widget:
                size_hint_x: 1
